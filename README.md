# Music Discovery API

This project implements a simple Music Discovery API using FastAPI. It demonstrates:

- RESTful design and CRUD for playlists
- API key protection for write operations
- Integration with Spotify API (optional client credentials flow)
- OpenAPI/Swagger docs
- Tests with pytest and a CI workflow

Getting started

1. Create a virtual environment and install dependencies:

```bash
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```

2. Copy `.env.example` to `.env` and set `API_KEY` (default demo key is `demo_api_key`).

Run the app

```bash
uvicorn app.main:app --reload
```

Docs

OpenAPI docs: http://localhost:8000/docs
OpenAPI JSON: http://localhost:8000/openapi.json

Security: write operations require the `X-API-KEY` header. Use the demo key `demo_api_key` locally or set `API_KEY` in your `.env` file.

API examples

- Public: list playlists

```bash
curl http://localhost:8000/api/v1/playlists
```

- Protected: create playlist (requires `X-API-KEY` header)

```bash
curl -X POST http://localhost:8000/api/v1/playlists \
  -H "Content-Type: application/json" \
  -H "X-API-KEY: demo_api_key" \
  -d '{"name":"My List","tracks":[]}'
```

Search (Spotify integration):

```bash
curl "http://localhost:8000/api/v1/search?q=daft+punk"
```

Testing

```bash
pytest -q
```

CI/CD

- A GitHub Actions workflow is included at `.github/workflows/ci.yml` to run tests and build a Docker image.
- To enable automatic deployment to Render, add `RENDER_API_KEY` and `RENDER_SERVICE_ID` to your repository secrets (Settings → Secrets → Actions). The workflow will trigger a deploy when those secrets are present.

Deployment (Render)

1. Create a new Web Service on Render and connect it to this repository.
2. Use Docker as the environment and the provided `Dockerfile`.
3. Add `API_KEY` and any Spotify credentials to Render service environment variables.
4. On push, the GitHub Actions job will trigger Render via API (when `RENDER_API_KEY` and `RENDER_SERVICE_ID` secrets are set).

Deliverables checklist

- [x] Functional codebase
- [x] OpenAPI docs (auto-generated by FastAPI)
- [x] cURL examples (above)
- [x] `.env.example`
- [x] Tests (including auth test)
- [ ] CI/CD configured for deployment provider (example workflow included)
